import {ao_update_ctx} from './core_updates.jsy'

export const delay = (...args) =>
  new Promise @ y =>
    setTimeout @ y, ...args

export function ao_pulse(ms, immediate) ::
  return ao_update_ctx @\ ao_update ::*
    const ts0 = Date.now()
    function _pulse() ::
      ao_update @ Date.now() - ts0

    const tid = setInterval @ _pulse, ms
    try ::
      if immediate :: _pulse()

      yield

    finally ::
      clearInterval @ tid

