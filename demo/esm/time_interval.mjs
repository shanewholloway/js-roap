const {
  assign: _obj_assign,
  defineProperties: _obj_props,
} = Object;

const ao_sym_done = Symbol('ao_done');

function ao_fence_v() {
  let p=0, _resume = ()=>{};
  let _pset = a => _resume = a;

  return [
    () => 0 !== p ? p
      : p = new Promise(_pset)

  , v => {p = 0; _resume(v);} ] }



const _ao_fence_api ={
  stop() {this.fence.done = true;}

, ao_fork() {
    return ao_fence_fork(this.fence)}

, [Symbol.asyncIterator]() {
    return this.ao_fork()} };

function ao_fence_fn(tgt) {
  let f = ao_fence_v();
  if (undefined === tgt) {tgt = f[0];}
  tgt.fence = _obj_assign(tgt, _ao_fence_api);
  return f}


async function * ao_fence_fork(fence) {
  while (! fence.done) {
    let v = await fence();
    if (fence.done || v === ao_sym_done) {
      return v}
    yield v;} }

function ao_interval(ms=1000) {
  let [_fence, _reset] = ao_fence_fn();
  let tid = setInterval(_reset, ms, 1);
  if (tid.unref) {tid.unref();}
  _fence.stop = (() => {
    tid = clearInterval(tid);
    _fence.done = true;});
  return _fence}


async function * ao_times(gen_in) {
  let ts0 = Date.now();
  for await (let v of gen_in) {
    yield Date.now() - ts0;} }

let demo_duration = setTimeout(Boolean, 15000);

{(async ()=>{
  let i = 0;
  for await (let v of ao_interval(1000)) {
    console.log('ao_interval',{v, i: i++}); } })();}

{(async ()=>{
  let i = 0;
  for await (let ts of ao_times(ao_interval(1000)) ) {
    console.log('ao_time ao_interval',{ts, i: i++}); } })();}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZV9pbnRlcnZhbC5tanMiLCJzb3VyY2VzIjpbIi4uLy4uL2VzbS9yb2FwLm1qcyIsIi4uL3RpbWVfaW50ZXJ2YWwuanN5Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHtcbiAgYXNzaWduOiBfb2JqX2Fzc2lnbixcbiAgZGVmaW5lUHJvcGVydGllczogX29ial9wcm9wcyxcbn0gPSBPYmplY3Q7XG5cbmNvbnN0IGlzX2FvX2l0ZXIgPSBnID0+XG4gIG51bGwgIT0gZ1tTeW1ib2wuYXN5bmNJdGVyYXRvcl07XG5cbmNvbnN0IF9pc19mbiA9IHZfZm4gPT5cbiAgJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIHZfZm5cbiAgICAmJiAhIGlzX2FvX2l0ZXIodl9mbik7XG5jb25zdCBfcmV0X2lkZW50ID0gdiA9PiB2O1xuXG5jb25zdCBfeGludm9rZSA9IHZfZm4gPT5cbiAgX2lzX2ZuKHZfZm4pXG4gICAgPyB2X2ZuKClcbiAgICA6IHZfZm47XG5cbmZ1bmN0aW9uIF94cGlwZV90Z3QocGlwZSkge1xuICBpZiAoX2lzX2ZuKHBpcGUpKSB7XG4gICAgcGlwZSA9IHBpcGUoKTtcbiAgICBwaXBlLm5leHQoKTtcbiAgICByZXR1cm4gcGlwZX1cblxuICByZXR1cm4gcGlwZS5nX2luIHx8IHBpcGV9XG5mdW5jdGlvbiAqIGl0ZXIoZ2VuX2luKSB7XG4gIHlpZWxkICogX3hpbnZva2UoZ2VuX2luKTt9XG5hc3luYyBmdW5jdGlvbiAqIGFvX2l0ZXIoZ2VuX2luKSB7XG4gIHlpZWxkICogX3hpbnZva2UoZ2VuX2luKTt9XG5cblxuZnVuY3Rpb24gZm5fY2hhaW4odGFpbCwgY3R4KSB7XG4gIHJldHVybiBfb2JqX2Fzc2lnbihjaGFpbiwge2NoYWluLCB0YWlsfSlcbiAgZnVuY3Rpb24gY2hhaW4oZm4pIHtcbiAgICBjaGFpbi50YWlsID0gZm4oY2hhaW4udGFpbCwgY3R4KTtcbiAgICByZXR1cm4gY2hhaW59IH1cblxuY29uc3QgYW9fZGVmZXJyZWRfdiA9ICgoKCkgPT4ge1xuICBsZXQgeSxuLF9wc2V0ID0gKGEsYikgPT4geyB5PWEsIG49YjsgfTtcbiAgcmV0dXJuIHAgPT4oXG4gICAgcCA9IG5ldyBQcm9taXNlKF9wc2V0KVxuICAsIFtwLCB5LCBuXSkgfSkoKSk7XG5cbmNvbnN0IGFvX2RlZmVycmVkID0gdiA9PihcbiAgdiA9IGFvX2RlZmVycmVkX3YoKVxuLCB7cHJvbWlzZTogdlswXSwgcmVzb2x2ZTogdlsxXSwgcmVqZWN0OiB2WzJdfSk7XG5cbmNvbnN0IGFvX3N5bV9kb25lID0gU3ltYm9sKCdhb19kb25lJyk7XG5cbmZ1bmN0aW9uIGFvX2ZlbmNlX3YoKSB7XG4gIGxldCBwPTAsIF9yZXN1bWUgPSAoKT0+e307XG4gIGxldCBfcHNldCA9IGEgPT4gX3Jlc3VtZSA9IGE7XG5cbiAgcmV0dXJuIFtcbiAgICAoKSA9PiAwICE9PSBwID8gcFxuICAgICAgOiBwID0gbmV3IFByb21pc2UoX3BzZXQpXG5cbiAgLCB2ID0+IHtwID0gMDsgX3Jlc3VtZSh2KTt9IF0gfVxuXG5cblxuY29uc3QgX2FvX2ZlbmNlX2FwaSA9e1xuICBzdG9wKCkge3RoaXMuZmVuY2UuZG9uZSA9IHRydWU7fVxuXG4sIGFvX2ZvcmsoKSB7XG4gICAgcmV0dXJuIGFvX2ZlbmNlX2ZvcmsodGhpcy5mZW5jZSl9XG5cbiwgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICByZXR1cm4gdGhpcy5hb19mb3JrKCl9IH07XG5cbmZ1bmN0aW9uIGFvX2ZlbmNlX2ZuKHRndCkge1xuICBsZXQgZiA9IGFvX2ZlbmNlX3YoKTtcbiAgaWYgKHVuZGVmaW5lZCA9PT0gdGd0KSB7dGd0ID0gZlswXTt9XG4gIHRndC5mZW5jZSA9IF9vYmpfYXNzaWduKHRndCwgX2FvX2ZlbmNlX2FwaSk7XG4gIHJldHVybiBmfVxuXG5mdW5jdGlvbiBhb19mZW5jZV9vYmoodGd0KSB7XG4gIGxldCBmID0gYW9fZmVuY2VfZm4odGd0KTtcbiAgcmV0dXJuIHtfX3Byb3RvX186IF9hb19mZW5jZV9hcGlcbiAgLCBmZW5jZTogdGd0IHx8IGZbMF0sIHJlc2V0OiBmWzFdfSB9XG5cblxuYXN5bmMgZnVuY3Rpb24gKiBhb19mZW5jZV9mb3JrKGZlbmNlKSB7XG4gIHdoaWxlICghIGZlbmNlLmRvbmUpIHtcbiAgICBsZXQgdiA9IGF3YWl0IGZlbmNlKCk7XG4gICAgaWYgKGZlbmNlLmRvbmUgfHwgdiA9PT0gYW9fc3ltX2RvbmUpIHtcbiAgICAgIHJldHVybiB2fVxuICAgIHlpZWxkIHY7fSB9XG5cblxuYXN5bmMgZnVuY3Rpb24gKiBfYW9fZmVuY2VfbG9vcChmZW5jZSwgcmVzZXQsIHhmb3JtKSB7XG4gIHRyeSB7XG4gICAgbGV0IHY7XG4gICAgd2hpbGUgKCEgZmVuY2UuZG9uZSkge1xuICAgICAgdiA9IGF3YWl0IGZlbmNlKCk7XG4gICAgICBpZiAodiA9PT0gYW9fc3ltX2RvbmUpIHtcbiAgICAgICAgcmV0dXJufVxuXG4gICAgICB2ID0geWllbGQgdjtcbiAgICAgIGlmICh1bmRlZmluZWQgIT09IHhmb3JtKSB7XG4gICAgICAgIHYgPSBhd2FpdCB4Zm9ybSh2KTt9XG4gICAgICByZXNldCh2KTsgfSB9XG4gIGZpbmFsbHkge1xuICAgIHJlc2V0KGFvX3N5bV9kb25lKTt9IH1cblxuYXN5bmMgZnVuY3Rpb24gYW9fcnVuKGdlbl9pbiwgbm90aWZ5PV9yZXRfaWRlbnQpIHtcbiAgZm9yIGF3YWl0IChsZXQgdiBvZiBfeGludm9rZShnZW5faW4pKSB7XG4gICAgbm90aWZ5KHYpO30gfVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGFvX2RyaXZlKGdlbl9pbiwgZ2VuX3RndCwgeGZvcm09X3JldF9pZGVudCkge1xuICBnZW5fdGd0ID0gX3hwaXBlX3RndChnZW5fdGd0KTtcbiAgZm9yIGF3YWl0IChsZXQgdiBvZiBfeGludm9rZShnZW5faW4pKSB7XG4gICAgaWYgKHVuZGVmaW5lZCAhPT0gZ2VuX3RndCkge1xuICAgICAgdiA9IHhmb3JtKHYpO1xuICAgICAgbGV0IHtkb25lfSA9IGF3YWl0IGdlbl90Z3QubmV4dCh2KTtcbiAgICAgIGlmIChkb25lKSB7YnJlYWt9IH0gfSB9XG5cblxuZnVuY3Rpb24gYW9fc3RlcF9pdGVyKGl0ZXJhYmxlLCBtdWx0aXBsZSkge1xuICBpdGVyYWJsZSA9IGFvX2l0ZXIoaXRlcmFibGUpO1xuICByZXR1cm4ge1xuICAgIGFzeW5jICogW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHtcbiAgICAgIGRvIHtcbiAgICAgICAgbGV0IHt2YWx1ZX0gPSBhd2FpdCBpdGVyYWJsZS5uZXh0KCk7XG4gICAgICAgIHlpZWxkIHZhbHVlO31cbiAgICAgIHdoaWxlIChtdWx0aXBsZSkgfSB9IH1cblxuXG5mdW5jdGlvbiBzdGVwX2l0ZXIoaXRlcmFibGUsIG11bHRpcGxlKSB7XG4gIGl0ZXJhYmxlID0gaXRlcihpdGVyYWJsZSk7XG4gIHJldHVybiB7XG4gICAgKltTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgZG8ge1xuICAgICAgICBsZXQge3ZhbHVlfSA9IGl0ZXJhYmxlLm5leHQoKTtcbiAgICAgICAgeWllbGQgdmFsdWU7fVxuICAgICAgd2hpbGUgKG11bHRpcGxlKSB9IH0gfVxuXG5mdW5jdGlvbiBhb19mb3JrKCkge1xuICByZXR1cm4gYW9fZmVuY2VfZm9yayh0aGlzLmZlbmNlKX1cblxuY29uc3QgX2FvX3RhcF9wcm9wcyA9e1xuICBhb19mb3JrOnt2YWx1ZTogYW9fZm9ya31cbiwgY2hhaW46e2dldCgpIHtcbiAgICByZXR1cm4gZm5fY2hhaW4odGhpcywgdGhpcyl9IH0gfTtcblxuZnVuY3Rpb24gYW9fdGFwKGFnX291dCkge1xuICByZXR1cm4gX29ial9wcm9wcyhfYW9fdGFwKGFnX291dCksIF9hb190YXBfcHJvcHMpIH1cblxuZnVuY3Rpb24gX2FvX3RhcChhZ19vdXQpIHtcbiAgbGV0IFtmZW5jZSwgcmVzZXRdID0gYW9fZmVuY2VfdigpO1xuICBsZXQgZ2VuID0gKChhc3luYyBmdW5jdGlvbiAqICgpIHtcbiAgICBmZW5jZS5kb25lID0gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGZvciBhd2FpdCAobGV0IHYgb2YgX3hpbnZva2UoYWdfb3V0KSkge1xuICAgICAgICByZXNldCh2KTtcbiAgICAgICAgeWllbGQgdjt9IH1cbiAgICBmaW5hbGx5IHtcbiAgICAgIGZlbmNlLmRvbmUgPSB0cnVlO1xuICAgICAgcmVzZXQoKTt9IH0pLmNhbGwodGhpcykpO1xuXG4gIGdlbi5mZW5jZSA9IGZlbmNlO1xuICByZXR1cm4gZ2VufVxuXG5cblxuY29uc3QgX2FvX3NwbGl0X2FwaSA9e1xuICBnZXQgY2hhaW4oKSB7XG4gICAgcmV0dXJuIGZuX2NoYWluKHRoaXMsIHRoaXMpfVxuLCBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiBhb19mb3JrXG4sIGFvX2Zvcmt9O1xuXG5mdW5jdGlvbiBhb19zcGxpdChhZ19vdXQpIHtcbiAgbGV0IGdlbiA9IF9hb190YXAoYWdfb3V0KTtcbiAgcmV0dXJuIHtcbiAgICBfX3Byb3RvX186IF9hb19zcGxpdF9hcGlcbiAgLCBmaW46IGFvX3J1bihnZW4pXG4gICwgZmVuY2U6IGdlbi5mZW5jZX0gfVxuXG5mdW5jdGlvbiBhb19xdWV1ZSh4Zm9ybSkge1xuICBsZXQgW2ZlbmNlLCBvdXRfcmVzZXRdID0gYW9fZmVuY2VfZm4oKTtcbiAgbGV0IFtpbl9mZW5jZSwgaW5fcmVzZXRdID0gYW9fZmVuY2VfdigpO1xuXG4gIGxldCBhZ19vdXQgPSBfYW9fZmVuY2VfbG9vcChmZW5jZSwgaW5fcmVzZXQpO1xuICBsZXQgZ19pbiA9IF9hb19mZW5jZV9sb29wKGluX2ZlbmNlLCBvdXRfcmVzZXQsIHhmb3JtKTtcblxuICAvLyBhbGxvdyBnX2luIHRvIGluaXRpYWxpemVcbiAgZ19pbi5uZXh0KCkgOyBpbl9yZXNldCgpO1xuICByZXR1cm4gX29ial9hc3NpZ24oYWdfb3V0LCB7ZmVuY2UsIGdfaW59KSB9XG5cbmNvbnN0IF9hc19waXBlX2VuZCA9IChnLG5zKSA9PiBfb2JqX2Fzc2lnbihnLCBucyk7XG5cbi8vfn5+XG4vLyBQaXBlIGJhc2UgYXMgZ2VuZXJhdG9yIGluIGNvbXBvc2VkIG9iamVjdC1mdW5jdGlvbmFsIGltcGxlbWVudGF0aW9uXG5cbmNvbnN0IF9hb19waXBlX2Jhc2UgPXtcbiAgeGZvbGQ6IHYgPT4gdiAvLyBvbiBwdXNoOiBpZGVudGl0eSB0cmFuc2Zvcm1cbiwgeHB1bGwoKSB7fSAvLyBtZW1vcnk6IG5vbmVcbiwgeGVtaXQ6IF94aW52b2tlIC8vIGlkZW50aXR5IHRyYW5zZm9ybSBvciBpbnZva2UgaWYgZnVuY3Rpb25cbiwgeGluaXQoZ19pbiwgYWdfb3V0KSB7fSAvLyBvbiBpbml0OiBkZWZhdWx0IGJlaGF2aW9yXG5cbiwgZ2V0IGNyZWF0ZSgpIHtcbiAgICAvLyBhcyBnZXR0ZXIgdG8gYmluZCBjbGFzcyBhcyBgdGhpc2AgYXQgYWNjZXNzIHRpbWVcbiAgICBjb25zdCBjcmVhdGUgPSAoLi4uIGFyZ3MpID0+XG4gICAgICBfb2JqX2Fzc2lnbih7X19wcm90b19fOiB0aGlzfSxcbiAgICAgICAgLi4uIGFyZ3MubWFwKF94aW52b2tlKSlcbiAgICAgIC5fYW9fcGlwZSgpO1xuXG4gICAgcmV0dXJuIGNyZWF0ZS5jcmVhdGUgPSBjcmVhdGV9XG5cbiwgX2FvX3BpcGUoKSB7XG4gICAgbGV0IGZpbl9sc3QgPSBbXTtcblxuICAgIGxldCBvbl9maW4gPSB0aGlzLm9uX2ZpbiA9XG4gICAgICBnID0+KGZpbl9sc3QucHVzaChnKSwgZyk7XG5cbiAgICBsZXQgc3RvcCA9IHRoaXMuc3RvcCA9ICgoKSA9PiB7XG4gICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuICAgICAgX2Zpbl9waXBlKGZpbl9sc3QpO1xuICAgICAgdGhpcy5fcmVzdW1lKCk7fSk7XG5cblxuICAgIGxldCBnX2luID0gb25fZmluKFxuICAgICAgdGhpcy5fYW9fcGlwZV9pbigpKTtcblxuICAgIGxldCBhZ19vdXQgPSBvbl9maW4oXG4gICAgICB0aGlzLl9hb19waXBlX291dCgpKTtcblxuICAgIC8vIGFkYXB0IGFnX291dCBieSBhcGkgYW5kIGtpbmRcbiAgICBsZXQgc2VsZiA9IHtzdG9wLCBvbl9maW4sIGdfaW59O1xuICAgIGFnX291dCA9IHRoaXMuX2FzX3BpcGVfb3V0KFxuICAgICAgYWdfb3V0LCBzZWxmLCB0aGlzLmtpbmQpO1xuXG4gICAgYWdfb3V0ID0gdGhpcy54aW5pdChnX2luLCBhZ19vdXQpIHx8IGFnX291dDtcblxuICAgIC8vIGFsbG93IGdfaW4gdG8gaW5pdGlhbGl6ZVxuICAgIGdfaW4ubmV4dCgpO1xuICAgIHJldHVybiBhZ19vdXR9XG5cbiwgX2FzX3BpcGVfb3V0OiBfYXNfcGlwZV9lbmRcblxuLCAvL35+flxuICAvLyBVcHN0cmVhbSBpbnB1dCBnZW5lcmF0b3JcbiAgLy8gICBkZXNpZ25lZCBmb3IgbXVsdGlwbGUgZmVlZGVyc1xuXG4gICpfYW9fcGlwZV9pbigpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IHY7XG4gICAgICB3aGlsZSAoISB0aGlzLmRvbmUpIHtcbiAgICAgICAgdiA9IHRoaXMueGZvbGQoeWllbGQgdik7XG4gICAgICAgIHRoaXMudmFsdWUgPSB2O1xuICAgICAgICBpZiAoMCAhPT0gdGhpcy5fd2FpdGluZyAmJiB1bmRlZmluZWQgIT09IHYpIHtcbiAgICAgICAgICB0aGlzLl9yZXN1bWUoKTt9IH0gfVxuXG4gICAgZmluYWxseSB7XG4gICAgICB0aGlzLnN0b3AoKTt9IH1cblxuXG4sIC8vfn5+XG4gIC8vIERvd25zdHJlYW0gYXN5bmMgb3V0cHV0IGdlbmVyYXRvclxuICAvLyAgIGRlc2lnbmVkIGZvciBzaW5nbGUgY29uc3VtZXIuXG5cbiAgYXN5bmMgKl9hb19waXBlX291dCgpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IHI7XG4gICAgICB3aGlsZSAoISB0aGlzLmRvbmUpIHtcbiAgICAgICAgaWYgKDAgIT09IChyID0gdGhpcy5fd2FpdGluZykpIHtcbiAgICAgICAgICAvLyBwMDogZXhpc3Rpbmcgd2FpdGVyc1xuICAgICAgICAgIHIgPSBhd2FpdCByO1xuICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHticmVha30gfVxuICAgICAgICBlbHNlIGlmICh1bmRlZmluZWQgIT09IChyID0gdGhpcy52YWx1ZSkpIHtcbiAgICAgICAgICAvLyBwMTogYXZhaWxhYmxlIHZhbHVlXG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDt9XG4gICAgICAgIGVsc2UgaWYgKHVuZGVmaW5lZCAhPT0gKHIgPSB0aGlzLnhwdWxsKCkpKSB7XG4gICAgICAgICAgfS8vIHAyOiB4cHVsbCB2YWx1ZSAoZS5nLiBxdWV1ZSBtZW1vcnkpIFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBwMzogYWRkIG5ldyB3YWl0ZXJcbiAgICAgICAgICByID0gYXdhaXQgdGhpcy5fYmluZF93YWl0aW5nKCk7XG4gICAgICAgICAgaWYgKHRoaXMuZG9uZSkge2JyZWFrfSB9XG5cbiAgICAgICAgeWllbGQgdGhpcy54ZW1pdChyKTt9IH1cblxuICAgIGZpbmFsbHkge1xuICAgICAgdGhpcy5zdG9wKCk7fSB9XG5cblxuLCAvL35+flxuICAvLyBnZW5lcmF0b3ItbGlrZSB2YWx1ZS9kb25lIHN0YXRlc1xuXG4gIHZhbHVlOiB1bmRlZmluZWRcbiwgZG9uZTogZmFsc2VcblxuLCAvL35+flxuICAvLyBwcm9taXNlLWJhc2VkIGZlbmNlIHRhaWxvcmVkIGZvciBhb19waXBlIHVzZWNhc2VcblxuICBfd2FpdGluZzogMFxuLCBfZnVsZmlsbCgpIHt9XG4sIGFzeW5jIF9yZXN1bWUoKSB7XG4gICAgaWYgKCEgdGhpcy5kb25lKSB7YXdhaXQgdGhpczt9XG5cbiAgICBsZXQge3ZhbHVlLCBfZnVsZmlsbH0gPSB0aGlzO1xuICAgIGlmICh1bmRlZmluZWQgIT0gdmFsdWUgfHwgdGhpcy5kb25lKSB7XG4gICAgICB0aGlzLnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5fd2FpdGluZyA9IDA7XG4gICAgICBfZnVsZmlsbCh2YWx1ZSk7fSB9XG5cbiwgX2JpbmRfd2FpdGluZygpIHtcbiAgICBsZXQgX3Jlc2V0ID0geSA9PiB0aGlzLl9mdWxmaWxsID0geTtcbiAgICB0aGlzLl9iaW5kX3dhaXRpbmcgPSAoKSA9PiB0aGlzLl93YWl0aW5nIHx8KFxuICAgICAgdGhpcy5fd2FpdGluZyA9IG5ldyBQcm9taXNlKF9yZXNldCkpO1xuICAgIHJldHVybiB0aGlzLl9iaW5kX3dhaXRpbmcoKX0gfTtcblxuXG5mdW5jdGlvbiBfZmluX3BpcGUoZmluX2xzdCkge1xuICB3aGlsZSAoMCAhPT0gZmluX2xzdC5sZW5ndGgpIHtcbiAgICBsZXQgZyA9IGZpbl9sc3QucG9wKCk7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChfaXNfZm4oZykpIHtnKCk7fVxuICAgICAgZWxzZSBnLnJldHVybigpO31cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgVHlwZUVycm9yKSB7XG4gICAgICAgIGlmICgnR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZycgPT09IGVyci5tZXNzYWdlKSB7XG4gICAgICAgICAgY29udGludWV9IH1cbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTt9IH0gfVxuXG5jb25zdCBfYW9fcGlwZV9vdXRfa2luZHMgPXtcbiAgYW9fcmF3OiBnID0+IGdcbiwgYW9fc3BsaXQ6IGFvX3NwbGl0XG4sIGFvX3RhcDogYW9fdGFwfTtcblxuZnVuY3Rpb24gX2FvX3BpcGVfb3V0KGFnX291dCwgc2VsZiwga2luZCkge1xuICBraW5kID0gL15hb18vLnRlc3Qoa2luZCkgPyBraW5kIDogJ2FvXycra2luZDtcbiAgbGV0IGFvX3dyYXAgPSBfYW9fcGlwZV9vdXRfa2luZHNba2luZF07XG4gIGlmICh1bmRlZmluZWQgPT09IGFvX3dyYXApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vbnduIGFvX3BpcGVfb3V0IGtpbmQgXCIke2tpbmR9XCJgKX1cblxuICByZXR1cm4gX29ial9hc3NpZ24oYW9fd3JhcChhZ19vdXQpLCBzZWxmKSB9XG5cbmNvbnN0IF9hb19waXBlID17XG4gIF9fcHJvdG9fXzogX2FvX3BpcGVfYmFzZVxuXG4sIC8vIHhmb2xkOiB2ID0+IHYgLS0gb24gcHVzaDogaWRlbnRpdHkgdHJhbnNmb3JtXG4gIC8vIHhwdWxsKCkge30gLS0gbWVtb3J5OiBub25lXG4gIC8vIHhlbWl0OiBfeGludm9rZSAtLSBpZGVudGl0eSB0cmFuc2Zvcm0gb3IgaW52b2tlIGlmIGZ1bmN0aW9uXG5cbiAgLy8gKnhnZm9sZCgpIC0tIG9uIHB1c2g6IGdlbmVyYXRvci1iYXNlZCBmb2xkIGltcGxcbiAgLy8gKnhzcmMoKSAtLSBmZWVkIHdpdGggc291cmNlIGdlbmVyYXRvclxuICAvLyAqeGN0eChnZW5fc3JjKSAtLSBvbiBpbml0OiBiaW5kIGV2ZW50IHNvdXJjZXNcblxuICBraW5kOiAnc3BsaXQnXG4sIC8vX2FzX3BpcGVfaW46IF9hb19waXBlX2luXG4gIF9hc19waXBlX291dDogX2FvX3BpcGVfb3V0XG5cbiwgeGluaXQoZ19pbiwgYWdfb3V0KSB7XG4gICAgbGV0IHhnZm9sZCA9IHRoaXMueGdmb2xkO1xuICAgIGlmICh1bmRlZmluZWQgIT09IHhnZm9sZCkge1xuICAgICAgdGhpcy5faW5pdF94Z2ZvbGQoZ19pbiwgeGdmb2xkKTt9XG5cbiAgICB0aGlzLl9pbml0X2NoYWluKGdfaW4pO31cblxuXG4sIF9pbml0X3hnZm9sZChnX2luLCB4Z2ZvbGQpIHtcbiAgICBpZiAodW5kZWZpbmVkID09PSB4Z2ZvbGQpIHtcbiAgICAgIHJldHVybn1cblxuICAgIGlmIChfaXNfZm4oeGdmb2xkKSkge1xuICAgICAgeGdmb2xkID0geGdmb2xkLmNhbGwodGhpcywgdGhpcyk7XG5cbiAgICAgIGlmIChfaXNfZm4oeGdmb2xkKSkge1xuICAgICAgICB0aGlzLnhmb2xkID0geGdmb2xkO1xuICAgICAgICByZXR1cm4gdHJ1ZX1cblxuICAgICAgeGdmb2xkLm5leHQoKTt9XG5cbiAgICB0aGlzLnhnZm9sZCA9IHhnZm9sZDtcbiAgICB0aGlzLnhmb2xkID0gdGhpcy5fZm9sZF9nZW47XG4gICAgdGhpcy5vbl9maW4oeGdmb2xkKTtcbiAgICByZXR1cm4gdHJ1ZX1cblxuLCBfZm9sZF9nZW4odikge1xuICAgIGxldCB7ZG9uZSwgdmFsdWV9ID0gdGhpcy54Z2ZvbGQubmV4dCh2KTtcbiAgICBpZiAoZG9uZSkge3RoaXMuZG9uZSA9IHRydWU7fVxuICAgIHJldHVybiB2YWx1ZX1cblxuXG4sIF9pbml0X2NoYWluKGdfaW4pIHtcbiAgICBsZXQge3hzcmMsIHhjdHh9ID0gdGhpcztcbiAgICBpZiAodW5kZWZpbmVkICE9PSB4c3JjKSB7XG4gICAgICBhb19kcml2ZSh4c3JjLCBnX2luKVxuICAgICAgICAudGhlbiAoKCkgPT5nX2luLnJldHVybigpKTsgfVxuXG4gICAgaWYgKHVuZGVmaW5lZCAhPT0geGN0eCkge1xuICAgICAgdGhpcy5fd2l0aF9jdHgoZ19pbiwgeGN0eCk7fSB9XG5cbiwgX3dpdGhfY3R4KGdfaW4sIHhjdHgpIHtcbiAgICBpZiAoX2lzX2ZuKHhjdHgpKSB7XG4gICAgICB4Y3R4ID0geGN0eChnX2luKTt9XG5cbiAgICBpZiAoeGN0eCAmJiB4Y3R4Lm5leHQpIHtcbiAgICAgIHhjdHgubmV4dChnX2luKTtcbiAgICAgIHRoaXMub25fZmluKHhjdHgpO31cbiAgICByZXR1cm4geGN0eH0gfTtcblxuY29uc3QgYW9fcGlwZSA9IF9hb19waXBlLmNyZWF0ZTtcblxuZnVuY3Rpb24gYW9faW50ZXJ2YWwobXM9MTAwMCkge1xuICBsZXQgW19mZW5jZSwgX3Jlc2V0XSA9IGFvX2ZlbmNlX2ZuKCk7XG4gIGxldCB0aWQgPSBzZXRJbnRlcnZhbChfcmVzZXQsIG1zLCAxKTtcbiAgaWYgKHRpZC51bnJlZikge3RpZC51bnJlZigpO31cbiAgX2ZlbmNlLnN0b3AgPSAoKCkgPT4ge1xuICAgIHRpZCA9IGNsZWFySW50ZXJ2YWwodGlkKTtcbiAgICBfZmVuY2UuZG9uZSA9IHRydWU7fSk7XG4gIHJldHVybiBfZmVuY2V9XG5cblxuZnVuY3Rpb24gYW9fdGltZW91dChtcz0xMDAwKSB7XG4gIGxldCB0aWQsIFtfZmVuY2UsIF9yZXNldF0gPSBhb19mZW5jZV9mbih0aW1lb3V0KTtcbiAgcmV0dXJuIHRpbWVvdXRcblxuICBmdW5jdGlvbiB0aW1lb3V0KCkge1xuICAgIHRpZCA9IHNldFRpbWVvdXQoX3Jlc2V0LCBtcywgMSk7XG4gICAgaWYgKHRpZC51bnJlZikge3RpZC51bnJlZigpO31cbiAgICByZXR1cm4gX2ZlbmNlKCl9IH1cblxuXG5mdW5jdGlvbiBhb19kZWJvdW5jZShtcz0zMDAsIGdlbl9pbikge1xuICBsZXQgdGlkLCBbX2ZlbmNlLCBfcmVzZXRdID0gYW9fZmVuY2VfZm4oKTtcblxuICBfZmVuY2UuZmluID0gKChhc3luYyAoKSA9PiB7XG4gICAgbGV0IHA7XG4gICAgZm9yIGF3YWl0IChsZXQgdiBvZiBfeGludm9rZShnZW5faW4pKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGlkKTtcbiAgICAgIGlmIChfZmVuY2UuZG9uZSkge3JldHVybn1cbiAgICAgIHAgPSBfZmVuY2UoKTtcbiAgICAgIHRpZCA9IHNldFRpbWVvdXQoX3Jlc2V0LCBtcywgdik7fVxuXG4gICAgYXdhaXQgcDtcbiAgICBfZmVuY2UuZG9uZSA9IHRydWU7fSkoKSk7XG5cbiAgcmV0dXJuIF9mZW5jZX1cblxuXG5hc3luYyBmdW5jdGlvbiAqIGFvX3RpbWVzKGdlbl9pbikge1xuICBsZXQgdHMwID0gRGF0ZS5ub3coKTtcbiAgZm9yIGF3YWl0IChsZXQgdiBvZiBnZW5faW4pIHtcbiAgICB5aWVsZCBEYXRlLm5vdygpIC0gdHMwO30gfVxuXG5mdW5jdGlvbiBhb19kb21fYW5pbWF0aW9uKCkge1xuICBsZXQgdGlkLCBbX2ZlbmNlLCBfcmVzZXRdID0gYW9fZmVuY2VfZm4ocmFmKTtcbiAgcmFmLnN0b3AgPSAoKCkgPT4ge1xuICAgIHRpZCA9IGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRpZCk7XG4gICAgcmFmLmRvbmUgPSB0cnVlO30pO1xuICByZXR1cm4gcmFmXG5cbiAgZnVuY3Rpb24gcmFmKCkge1xuICAgIHRpZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShfcmVzZXQpO1xuICAgIHJldHVybiBfZmVuY2UoKX0gfVxuXG5jb25zdCBfZXZ0X2luaXQgPSBQcm9taXNlLnJlc29sdmUoe3R5cGU6J2luaXQnfSk7XG5mdW5jdGlvbiBhb19kb21fbGlzdGVuKHBpcGUgPSBhb19xdWV1ZSgpKSB7XG4gIGxldCB3aXRoX2RvbSA9IChkb20sIGZuKSA9PlxuICAgIGRvbS5hZGRFdmVudExpc3RlbmVyXG4gICAgICA/IF9hb193aXRoX2RvbShfYmluZCwgZm4sIGRvbSlcbiAgICAgIDogX2FvX3dpdGhfZG9tX3ZlYyhfYmluZCwgZm4sIGRvbSk7XG5cbiAgX2JpbmQuc2VsZiA9IHtwaXBlLCB3aXRoX2RvbX07XG4gIHBpcGUud2l0aF9kb20gPSB3aXRoX2RvbTtcbiAgcmV0dXJuIHBpcGVcblxuICBmdW5jdGlvbiBfYmluZChkb20sIGZuX2V2dCwgZm5fZG9tKSB7XG4gICAgcmV0dXJuIGV2dCA9PiB7XG4gICAgICBsZXQgdiA9IGZuX2V2dFxuICAgICAgICA/IGZuX2V2dChldnQsIGRvbSwgZm5fZG9tKVxuICAgICAgICA6IGZuX2RvbShkb20sIGV2dCk7XG5cbiAgICAgIGlmIChudWxsICE9IHYpIHtcbiAgICAgICAgcGlwZS5nX2luLm5leHQodik7fSB9IH0gfVxuXG5cbmZ1bmN0aW9uIF9hb193aXRoX2RvbShfYmluZCwgZm4sIGRvbSkge1xuICBsZXQgX29uX2V2dDtcbiAgaWYgKF9pc19mbihmbikpIHtcbiAgICBfZXZ0X2luaXQudGhlbihcbiAgICAgIF9vbl9ldnQgPSBfYmluZChkb20sIHZvaWQgMCwgZm4pKTsgfVxuXG4gIHJldHVybiB7XG4gICAgX19wcm90b19fOiBfYmluZC5zZWxmXG4gICwgbGlzdGVuKC4uLmFyZ3MpIHtcbiAgICAgIGxldCBvcHQsIGV2dF9mbiA9IF9vbl9ldnQ7XG5cbiAgICAgIGxldCBsYXN0ID0gYXJncy5wb3AoKTtcbiAgICAgIGlmICgnZnVuY3Rpb24nID09PSB0eXBlb2YgbGFzdCkge1xuICAgICAgICBldnRfZm4gPSBfYmluZChkb20sIGxhc3QsIF9vbl9ldnQpO1xuICAgICAgICBsYXN0ID0gYXJncy5wb3AoKTt9XG5cbiAgICAgIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIGxhc3QpIHtcbiAgICAgICAgYXJncy5wdXNoKGxhc3QpO31cbiAgICAgIGVsc2Ugb3B0ID0gbGFzdDtcblxuICAgICAgZm9yIChsZXQgZXZ0IG9mIGFyZ3MpIHtcbiAgICAgICAgZG9tLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgZXZ0LCBldnRfZm4sIG9wdCk7IH1cblxuICAgICAgcmV0dXJuIHRoaXN9IH0gfVxuXG5cbmZ1bmN0aW9uIF9hb193aXRoX2RvbV92ZWMoX2JpbmQsIGZuLCBlY3R4X2xpc3QpIHtcbiAgZWN0eF9saXN0ID0gQXJyYXkuZnJvbShlY3R4X2xpc3QsXG4gICAgZG9tID0+IF9hb193aXRoX2RvbShfYmluZCwgZm4sIGRvbSkpO1xuXG4gIHJldHVybiB7XG4gICAgX19wcm90b19fOiBfYmluZC5zZWxmXG4gICwgbGlzdGVuKC4uLmFyZ3MpIHtcbiAgICAgIGZvciAobGV0IGVjdHggb2YgZWN0eF9saXN0KSB7XG4gICAgICAgIGVjdHgubGlzdGVuKC4uLmFyZ3MpO31cbiAgICAgIHJldHVybiB0aGlzfSB9IH1cblxuZXhwb3J0IHsgX2FvX2ZlbmNlX2xvb3AsIF9hb19waXBlLCBfYW9fcGlwZV9iYXNlLCBfYW9fcGlwZV9vdXQsIF9hb19waXBlX291dF9raW5kcywgX2FvX3RhcCwgX3hpbnZva2UsIF94cGlwZV90Z3QsIGFvX2RlYm91bmNlLCBhb19kZWZlcnJlZCwgYW9fZGVmZXJyZWRfdiwgYW9fZG9tX2FuaW1hdGlvbiwgYW9fZG9tX2xpc3RlbiwgYW9fZHJpdmUsIGFvX2ZlbmNlX2ZuLCBhb19mZW5jZV9mb3JrLCBhb19mZW5jZV9vYmosIGFvX2ZlbmNlX3YsIGFvX2ludGVydmFsLCBhb19pdGVyLCBhb19waXBlLCBhb19xdWV1ZSwgYW9fcnVuLCBhb19zcGxpdCwgYW9fc3RlcF9pdGVyLCBhb19zeW1fZG9uZSwgYW9fdGFwLCBhb190aW1lb3V0LCBhb190aW1lcywgZm5fY2hhaW4sIGlzX2FvX2l0ZXIsIGl0ZXIsIHN0ZXBfaXRlciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cm9hcC5tanMubWFwXG4iLCJpbXBvcnQge2FvX2ludGVydmFsLCBhb190aW1lc30gZnJvbSAncm9hcCdcblxubGV0IGRlbW9fZHVyYXRpb24gPSBzZXRUaW1lb3V0IEAgQm9vbGVhbiwgMTUwMDBcblxuOjohPlxuICBsZXQgaSA9IDBcbiAgZm9yIGF3YWl0IGxldCB2IG9mIGFvX2ludGVydmFsKDEwMDApIDo6XG4gICAgY29uc29sZS5sb2cgQCAnYW9faW50ZXJ2YWwnLCBAe30gdiwgaTogaSsrXG5cbjo6IT5cbiAgbGV0IGkgPSAwXG4gIGZvciBhd2FpdCBsZXQgdHMgb2YgYW9fdGltZXMgQCBhb19pbnRlcnZhbCgxMDAwKSA6OlxuICAgIGNvbnNvbGUubG9nIEAgJ2FvX3RpbWUgYW9faW50ZXJ2YWwnLCBAe30gdHMsIGk6IGkrK1xuXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTTtBQUNOLEVBQUUsTUFBTSxFQUFFLFdBQVc7QUFDckIsRUFBRSxnQkFBZ0IsRUFBRSxVQUFVO0FBQzlCLENBQUMsR0FBRyxNQUFNLENBQUM7QUEyQ1g7QUFDQSxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDdEM7QUFDQSxTQUFTLFVBQVUsR0FBRztBQUN0QixFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEdBQUcsSUFBSSxFQUFFLENBQUM7QUFDNUIsRUFBRSxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztBQUMvQjtBQUNBLEVBQUUsT0FBTztBQUNULElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7QUFDckIsUUFBUSxDQUFDLEdBQUcsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDO0FBQzlCO0FBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFD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
