const {
  assign: _obj_assign,
  defineProperties: _obj_props,
} = Object;

const ao_sym_done = Symbol('ao_done');

function ao_fence_v() {
  let p=0, _resume = ()=>{};
  let _pset = a => _resume = a;

  return [
    () => 0 !== p ? p
      : p = new Promise(_pset)

  , v => {p = 0; _resume(v);} ] }



const _ao_fence_api ={
  stop() {this.fence.done = true;}

, ao_fork() {
    return ao_fence_fork(this.fence)}

, [Symbol.asyncIterator]() {
    return this.ao_fork()} };

function ao_fence_fn(tgt) {
  let f = ao_fence_v();
  if (undefined === tgt) {tgt = f[0];}
  tgt.fence = _obj_assign(tgt, _ao_fence_api);
  return f}


async function * ao_fence_fork(fence) {
  while (! fence.done) {
    let v = await fence();
    if (fence.done || v === ao_sym_done) {
      return v}
    yield v;} }


function ao_timeout(ms=1000) {
  let tid, [_fence, _reset] = ao_fence_fn(timeout);
  return timeout

  function timeout() {
    tid = setTimeout(_reset, ms, 1);
    if (tid.unref) {tid.unref();}
    return _fence()} }


async function * ao_times(gen_in) {
  let ts0 = Date.now();
  for await (let v of gen_in) {
    yield Date.now() - ts0;} }

let demo_duration = setTimeout(Boolean, 15000);

{(async ()=>{
  let i = 0;
  for await (let v of ao_timeout(1000)) {
    console.log('ao_timeout',{v, i: i++}); } })();}

{(async ()=>{
  let i = 0;
  for await (let ts of ao_times(ao_timeout(1000)) ) {
    console.log('ao_time @ ao_timeout',{ts, i: i++}); } })();}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZV90aW1lb3V0Lm1qcyIsInNvdXJjZXMiOlsiLi4vLi4vZXNtL3JvYXAubWpzIiwiLi4vdGltZV90aW1lb3V0LmpzeSJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7XG4gIGFzc2lnbjogX29ial9hc3NpZ24sXG4gIGRlZmluZVByb3BlcnRpZXM6IF9vYmpfcHJvcHMsXG59ID0gT2JqZWN0O1xuXG5jb25zdCBpc19hb19pdGVyID0gZyA9PlxuICBudWxsICE9IGdbU3ltYm9sLmFzeW5jSXRlcmF0b3JdO1xuXG5jb25zdCBfaXNfZm4gPSB2X2ZuID0+XG4gICdmdW5jdGlvbicgPT09IHR5cGVvZiB2X2ZuXG4gICAgJiYgISBpc19hb19pdGVyKHZfZm4pO1xuY29uc3QgX3JldF9pZGVudCA9IHYgPT4gdjtcblxuY29uc3QgX3hpbnZva2UgPSB2X2ZuID0+XG4gIF9pc19mbih2X2ZuKVxuICAgID8gdl9mbigpXG4gICAgOiB2X2ZuO1xuXG5mdW5jdGlvbiBfeHBpcGVfdGd0KHBpcGUpIHtcbiAgaWYgKF9pc19mbihwaXBlKSkge1xuICAgIHBpcGUgPSBwaXBlKCk7XG4gICAgcGlwZS5uZXh0KCk7XG4gICAgcmV0dXJuIHBpcGV9XG5cbiAgcmV0dXJuIHBpcGUuZ19pbiB8fCBwaXBlfVxuZnVuY3Rpb24gKiBpdGVyKGdlbl9pbikge1xuICB5aWVsZCAqIF94aW52b2tlKGdlbl9pbik7fVxuYXN5bmMgZnVuY3Rpb24gKiBhb19pdGVyKGdlbl9pbikge1xuICB5aWVsZCAqIF94aW52b2tlKGdlbl9pbik7fVxuXG5cbmZ1bmN0aW9uIGZuX2NoYWluKHRhaWwsIGN0eCkge1xuICByZXR1cm4gX29ial9hc3NpZ24oY2hhaW4sIHtjaGFpbiwgdGFpbH0pXG4gIGZ1bmN0aW9uIGNoYWluKGZuKSB7XG4gICAgY2hhaW4udGFpbCA9IGZuKGNoYWluLnRhaWwsIGN0eCk7XG4gICAgcmV0dXJuIGNoYWlufSB9XG5cbmNvbnN0IGFvX2RlZmVycmVkX3YgPSAoKCgpID0+IHtcbiAgbGV0IHksbixfcHNldCA9IChhLGIpID0+IHsgeT1hLCBuPWI7IH07XG4gIHJldHVybiBwID0+KFxuICAgIHAgPSBuZXcgUHJvbWlzZShfcHNldClcbiAgLCBbcCwgeSwgbl0pIH0pKCkpO1xuXG5jb25zdCBhb19kZWZlcnJlZCA9IHYgPT4oXG4gIHYgPSBhb19kZWZlcnJlZF92KClcbiwge3Byb21pc2U6IHZbMF0sIHJlc29sdmU6IHZbMV0sIHJlamVjdDogdlsyXX0pO1xuXG5jb25zdCBhb19zeW1fZG9uZSA9IFN5bWJvbCgnYW9fZG9uZScpO1xuXG5mdW5jdGlvbiBhb19mZW5jZV92KCkge1xuICBsZXQgcD0wLCBfcmVzdW1lID0gKCk9Pnt9O1xuICBsZXQgX3BzZXQgPSBhID0+IF9yZXN1bWUgPSBhO1xuXG4gIHJldHVybiBbXG4gICAgKCkgPT4gMCAhPT0gcCA/IHBcbiAgICAgIDogcCA9IG5ldyBQcm9taXNlKF9wc2V0KVxuXG4gICwgdiA9PiB7cCA9IDA7IF9yZXN1bWUodik7fSBdIH1cblxuXG5cbmNvbnN0IF9hb19mZW5jZV9hcGkgPXtcbiAgc3RvcCgpIHt0aGlzLmZlbmNlLmRvbmUgPSB0cnVlO31cblxuLCBhb19mb3JrKCkge1xuICAgIHJldHVybiBhb19mZW5jZV9mb3JrKHRoaXMuZmVuY2UpfVxuXG4sIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgcmV0dXJuIHRoaXMuYW9fZm9yaygpfSB9O1xuXG5mdW5jdGlvbiBhb19mZW5jZV9mbih0Z3QpIHtcbiAgbGV0IGYgPSBhb19mZW5jZV92KCk7XG4gIGlmICh1bmRlZmluZWQgPT09IHRndCkge3RndCA9IGZbMF07fVxuICB0Z3QuZmVuY2UgPSBfb2JqX2Fzc2lnbih0Z3QsIF9hb19mZW5jZV9hcGkpO1xuICByZXR1cm4gZn1cblxuZnVuY3Rpb24gYW9fZmVuY2Vfb2JqKHRndCkge1xuICBsZXQgZiA9IGFvX2ZlbmNlX2ZuKHRndCk7XG4gIHJldHVybiB7X19wcm90b19fOiBfYW9fZmVuY2VfYXBpXG4gICwgZmVuY2U6IHRndCB8fCBmWzBdLCByZXNldDogZlsxXX0gfVxuXG5cbmFzeW5jIGZ1bmN0aW9uICogYW9fZmVuY2VfZm9yayhmZW5jZSkge1xuICB3aGlsZSAoISBmZW5jZS5kb25lKSB7XG4gICAgbGV0IHYgPSBhd2FpdCBmZW5jZSgpO1xuICAgIGlmIChmZW5jZS5kb25lIHx8IHYgPT09IGFvX3N5bV9kb25lKSB7XG4gICAgICByZXR1cm4gdn1cbiAgICB5aWVsZCB2O30gfVxuXG5cbmFzeW5jIGZ1bmN0aW9uICogX2FvX2ZlbmNlX2xvb3AoZmVuY2UsIHJlc2V0LCB4Zm9ybSkge1xuICB0cnkge1xuICAgIGxldCB2O1xuICAgIHdoaWxlICghIGZlbmNlLmRvbmUpIHtcbiAgICAgIHYgPSBhd2FpdCBmZW5jZSgpO1xuICAgICAgaWYgKHYgPT09IGFvX3N5bV9kb25lKSB7XG4gICAgICAgIHJldHVybn1cblxuICAgICAgdiA9IHlpZWxkIHY7XG4gICAgICBpZiAodW5kZWZpbmVkICE9PSB4Zm9ybSkge1xuICAgICAgICB2ID0gYXdhaXQgeGZvcm0odik7fVxuICAgICAgcmVzZXQodik7IH0gfVxuICBmaW5hbGx5IHtcbiAgICByZXNldChhb19zeW1fZG9uZSk7fSB9XG5cbmFzeW5jIGZ1bmN0aW9uIGFvX3J1bihnZW5faW4sIG5vdGlmeT1fcmV0X2lkZW50KSB7XG4gIGZvciBhd2FpdCAobGV0IHYgb2YgX3hpbnZva2UoZ2VuX2luKSkge1xuICAgIG5vdGlmeSh2KTt9IH1cblxuXG5hc3luYyBmdW5jdGlvbiBhb19kcml2ZShnZW5faW4sIGdlbl90Z3QsIHhmb3JtPV9yZXRfaWRlbnQpIHtcbiAgZ2VuX3RndCA9IF94cGlwZV90Z3QoZ2VuX3RndCk7XG4gIGZvciBhd2FpdCAobGV0IHYgb2YgX3hpbnZva2UoZ2VuX2luKSkge1xuICAgIGlmICh1bmRlZmluZWQgIT09IGdlbl90Z3QpIHtcbiAgICAgIHYgPSB4Zm9ybSh2KTtcbiAgICAgIGxldCB7ZG9uZX0gPSBhd2FpdCBnZW5fdGd0Lm5leHQodik7XG4gICAgICBpZiAoZG9uZSkge2JyZWFrfSB9IH0gfVxuXG5cbmZ1bmN0aW9uIGFvX3N0ZXBfaXRlcihpdGVyYWJsZSwgbXVsdGlwbGUpIHtcbiAgaXRlcmFibGUgPSBhb19pdGVyKGl0ZXJhYmxlKTtcbiAgcmV0dXJuIHtcbiAgICBhc3luYyAqIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICBkbyB7XG4gICAgICAgIGxldCB7dmFsdWV9ID0gYXdhaXQgaXRlcmFibGUubmV4dCgpO1xuICAgICAgICB5aWVsZCB2YWx1ZTt9XG4gICAgICB3aGlsZSAobXVsdGlwbGUpIH0gfSB9XG5cblxuZnVuY3Rpb24gc3RlcF9pdGVyKGl0ZXJhYmxlLCBtdWx0aXBsZSkge1xuICBpdGVyYWJsZSA9IGl0ZXIoaXRlcmFibGUpO1xuICByZXR1cm4ge1xuICAgICpbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgIGRvIHtcbiAgICAgICAgbGV0IHt2YWx1ZX0gPSBpdGVyYWJsZS5uZXh0KCk7XG4gICAgICAgIHlpZWxkIHZhbHVlO31cbiAgICAgIHdoaWxlIChtdWx0aXBsZSkgfSB9IH1cblxuZnVuY3Rpb24gYW9fZm9yaygpIHtcbiAgcmV0dXJuIGFvX2ZlbmNlX2ZvcmsodGhpcy5mZW5jZSl9XG5cbmNvbnN0IF9hb190YXBfcHJvcHMgPXtcbiAgYW9fZm9yazp7dmFsdWU6IGFvX2Zvcmt9XG4sIGNoYWluOntnZXQoKSB7XG4gICAgcmV0dXJuIGZuX2NoYWluKHRoaXMsIHRoaXMpfSB9IH07XG5cbmZ1bmN0aW9uIGFvX3RhcChhZ19vdXQpIHtcbiAgcmV0dXJuIF9vYmpfcHJvcHMoX2FvX3RhcChhZ19vdXQpLCBfYW9fdGFwX3Byb3BzKSB9XG5cbmZ1bmN0aW9uIF9hb190YXAoYWdfb3V0KSB7XG4gIGxldCBbZmVuY2UsIHJlc2V0XSA9IGFvX2ZlbmNlX3YoKTtcbiAgbGV0IGdlbiA9ICgoYXN5bmMgZnVuY3Rpb24gKiAoKSB7XG4gICAgZmVuY2UuZG9uZSA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBmb3IgYXdhaXQgKGxldCB2IG9mIF94aW52b2tlKGFnX291dCkpIHtcbiAgICAgICAgcmVzZXQodik7XG4gICAgICAgIHlpZWxkIHY7fSB9XG4gICAgZmluYWxseSB7XG4gICAgICBmZW5jZS5kb25lID0gdHJ1ZTtcbiAgICAgIHJlc2V0KCk7fSB9KS5jYWxsKHRoaXMpKTtcblxuICBnZW4uZmVuY2UgPSBmZW5jZTtcbiAgcmV0dXJuIGdlbn1cblxuXG5cbmNvbnN0IF9hb19zcGxpdF9hcGkgPXtcbiAgZ2V0IGNoYWluKCkge1xuICAgIHJldHVybiBmbl9jaGFpbih0aGlzLCB0aGlzKX1cbiwgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogYW9fZm9ya1xuLCBhb19mb3JrfTtcblxuZnVuY3Rpb24gYW9fc3BsaXQoYWdfb3V0KSB7XG4gIGxldCBnZW4gPSBfYW9fdGFwKGFnX291dCk7XG4gIHJldHVybiB7XG4gICAgX19wcm90b19fOiBfYW9fc3BsaXRfYXBpXG4gICwgZmluOiBhb19ydW4oZ2VuKVxuICAsIGZlbmNlOiBnZW4uZmVuY2V9IH1cblxuZnVuY3Rpb24gYW9fcXVldWUoeGZvcm0pIHtcbiAgbGV0IFtmZW5jZSwgb3V0X3Jlc2V0XSA9IGFvX2ZlbmNlX2ZuKCk7XG4gIGxldCBbaW5fZmVuY2UsIGluX3Jlc2V0XSA9IGFvX2ZlbmNlX3YoKTtcblxuICBsZXQgYWdfb3V0ID0gX2FvX2ZlbmNlX2xvb3AoZmVuY2UsIGluX3Jlc2V0KTtcbiAgbGV0IGdfaW4gPSBfYW9fZmVuY2VfbG9vcChpbl9mZW5jZSwgb3V0X3Jlc2V0LCB4Zm9ybSk7XG5cbiAgLy8gYWxsb3cgZ19pbiB0byBpbml0aWFsaXplXG4gIGdfaW4ubmV4dCgpIDsgaW5fcmVzZXQoKTtcbiAgcmV0dXJuIF9vYmpfYXNzaWduKGFnX291dCwge2ZlbmNlLCBnX2lufSkgfVxuXG5jb25zdCBfYXNfcGlwZV9lbmQgPSAoZyxucykgPT4gX29ial9hc3NpZ24oZywgbnMpO1xuXG4vL35+flxuLy8gUGlwZSBiYXNlIGFzIGdlbmVyYXRvciBpbiBjb21wb3NlZCBvYmplY3QtZnVuY3Rpb25hbCBpbXBsZW1lbnRhdGlvblxuXG5jb25zdCBfYW9fcGlwZV9iYXNlID17XG4gIHhmb2xkOiB2ID0+IHYgLy8gb24gcHVzaDogaWRlbnRpdHkgdHJhbnNmb3JtXG4sIHhwdWxsKCkge30gLy8gbWVtb3J5OiBub25lXG4sIHhlbWl0OiBfeGludm9rZSAvLyBpZGVudGl0eSB0cmFuc2Zvcm0gb3IgaW52b2tlIGlmIGZ1bmN0aW9uXG4sIHhpbml0KGdfaW4sIGFnX291dCkge30gLy8gb24gaW5pdDogZGVmYXVsdCBiZWhhdmlvclxuXG4sIGdldCBjcmVhdGUoKSB7XG4gICAgLy8gYXMgZ2V0dGVyIHRvIGJpbmQgY2xhc3MgYXMgYHRoaXNgIGF0IGFjY2VzcyB0aW1lXG4gICAgY29uc3QgY3JlYXRlID0gKC4uLiBhcmdzKSA9PlxuICAgICAgX29ial9hc3NpZ24oe19fcHJvdG9fXzogdGhpc30sXG4gICAgICAgIC4uLiBhcmdzLm1hcChfeGludm9rZSkpXG4gICAgICAuX2FvX3BpcGUoKTtcblxuICAgIHJldHVybiBjcmVhdGUuY3JlYXRlID0gY3JlYXRlfVxuXG4sIF9hb19waXBlKCkge1xuICAgIGxldCBmaW5fbHN0ID0gW107XG5cbiAgICBsZXQgb25fZmluID0gdGhpcy5vbl9maW4gPVxuICAgICAgZyA9PihmaW5fbHN0LnB1c2goZyksIGcpO1xuXG4gICAgbGV0IHN0b3AgPSB0aGlzLnN0b3AgPSAoKCkgPT4ge1xuICAgICAgdGhpcy5kb25lID0gdHJ1ZTtcbiAgICAgIF9maW5fcGlwZShmaW5fbHN0KTtcbiAgICAgIHRoaXMuX3Jlc3VtZSgpO30pO1xuXG5cbiAgICBsZXQgZ19pbiA9IG9uX2ZpbihcbiAgICAgIHRoaXMuX2FvX3BpcGVfaW4oKSk7XG5cbiAgICBsZXQgYWdfb3V0ID0gb25fZmluKFxuICAgICAgdGhpcy5fYW9fcGlwZV9vdXQoKSk7XG5cbiAgICAvLyBhZGFwdCBhZ19vdXQgYnkgYXBpIGFuZCBraW5kXG4gICAgbGV0IHNlbGYgPSB7c3RvcCwgb25fZmluLCBnX2lufTtcbiAgICBhZ19vdXQgPSB0aGlzLl9hc19waXBlX291dChcbiAgICAgIGFnX291dCwgc2VsZiwgdGhpcy5raW5kKTtcblxuICAgIGFnX291dCA9IHRoaXMueGluaXQoZ19pbiwgYWdfb3V0KSB8fCBhZ19vdXQ7XG5cbiAgICAvLyBhbGxvdyBnX2luIHRvIGluaXRpYWxpemVcbiAgICBnX2luLm5leHQoKTtcbiAgICByZXR1cm4gYWdfb3V0fVxuXG4sIF9hc19waXBlX291dDogX2FzX3BpcGVfZW5kXG5cbiwgLy9+fn5cbiAgLy8gVXBzdHJlYW0gaW5wdXQgZ2VuZXJhdG9yXG4gIC8vICAgZGVzaWduZWQgZm9yIG11bHRpcGxlIGZlZWRlcnNcblxuICAqX2FvX3BpcGVfaW4oKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCB2O1xuICAgICAgd2hpbGUgKCEgdGhpcy5kb25lKSB7XG4gICAgICAgIHYgPSB0aGlzLnhmb2xkKHlpZWxkIHYpO1xuICAgICAgICB0aGlzLnZhbHVlID0gdjtcbiAgICAgICAgaWYgKDAgIT09IHRoaXMuX3dhaXRpbmcgJiYgdW5kZWZpbmVkICE9PSB2KSB7XG4gICAgICAgICAgdGhpcy5fcmVzdW1lKCk7fSB9IH1cblxuICAgIGZpbmFsbHkge1xuICAgICAgdGhpcy5zdG9wKCk7fSB9XG5cblxuLCAvL35+flxuICAvLyBEb3duc3RyZWFtIGFzeW5jIG91dHB1dCBnZW5lcmF0b3JcbiAgLy8gICBkZXNpZ25lZCBmb3Igc2luZ2xlIGNvbnN1bWVyLlxuXG4gIGFzeW5jICpfYW9fcGlwZV9vdXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCByO1xuICAgICAgd2hpbGUgKCEgdGhpcy5kb25lKSB7XG4gICAgICAgIGlmICgwICE9PSAociA9IHRoaXMuX3dhaXRpbmcpKSB7XG4gICAgICAgICAgLy8gcDA6IGV4aXN0aW5nIHdhaXRlcnNcbiAgICAgICAgICByID0gYXdhaXQgcjtcbiAgICAgICAgICBpZiAodGhpcy5kb25lKSB7YnJlYWt9IH1cbiAgICAgICAgZWxzZSBpZiAodW5kZWZpbmVkICE9PSAociA9IHRoaXMudmFsdWUpKSB7XG4gICAgICAgICAgLy8gcDE6IGF2YWlsYWJsZSB2YWx1ZVxuICAgICAgICAgIHRoaXMudmFsdWUgPSB1bmRlZmluZWQ7fVxuICAgICAgICBlbHNlIGlmICh1bmRlZmluZWQgIT09IChyID0gdGhpcy54cHVsbCgpKSkge1xuICAgICAgICAgIH0vLyBwMjogeHB1bGwgdmFsdWUgKGUuZy4gcXVldWUgbWVtb3J5KSBcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgLy8gcDM6IGFkZCBuZXcgd2FpdGVyXG4gICAgICAgICAgciA9IGF3YWl0IHRoaXMuX2JpbmRfd2FpdGluZygpO1xuICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHticmVha30gfVxuXG4gICAgICAgIHlpZWxkIHRoaXMueGVtaXQocik7fSB9XG5cbiAgICBmaW5hbGx5IHtcbiAgICAgIHRoaXMuc3RvcCgpO30gfVxuXG5cbiwgLy9+fn5cbiAgLy8gZ2VuZXJhdG9yLWxpa2UgdmFsdWUvZG9uZSBzdGF0ZXNcblxuICB2YWx1ZTogdW5kZWZpbmVkXG4sIGRvbmU6IGZhbHNlXG5cbiwgLy9+fn5cbiAgLy8gcHJvbWlzZS1iYXNlZCBmZW5jZSB0YWlsb3JlZCBmb3IgYW9fcGlwZSB1c2VjYXNlXG5cbiAgX3dhaXRpbmc6IDBcbiwgX2Z1bGZpbGwoKSB7fVxuLCBhc3luYyBfcmVzdW1lKCkge1xuICAgIGlmICghIHRoaXMuZG9uZSkge2F3YWl0IHRoaXM7fVxuXG4gICAgbGV0IHt2YWx1ZSwgX2Z1bGZpbGx9ID0gdGhpcztcbiAgICBpZiAodW5kZWZpbmVkICE9IHZhbHVlIHx8IHRoaXMuZG9uZSkge1xuICAgICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuX3dhaXRpbmcgPSAwO1xuICAgICAgX2Z1bGZpbGwodmFsdWUpO30gfVxuXG4sIF9iaW5kX3dhaXRpbmcoKSB7XG4gICAgbGV0IF9yZXNldCA9IHkgPT4gdGhpcy5fZnVsZmlsbCA9IHk7XG4gICAgdGhpcy5fYmluZF93YWl0aW5nID0gKCkgPT4gdGhpcy5fd2FpdGluZyB8fChcbiAgICAgIHRoaXMuX3dhaXRpbmcgPSBuZXcgUHJvbWlzZShfcmVzZXQpKTtcbiAgICByZXR1cm4gdGhpcy5fYmluZF93YWl0aW5nKCl9IH07XG5cblxuZnVuY3Rpb24gX2Zpbl9waXBlKGZpbl9sc3QpIHtcbiAgd2hpbGUgKDAgIT09IGZpbl9sc3QubGVuZ3RoKSB7XG4gICAgbGV0IGcgPSBmaW5fbHN0LnBvcCgpO1xuICAgIHRyeSB7XG4gICAgICBpZiAoX2lzX2ZuKGcpKSB7ZygpO31cbiAgICAgIGVsc2UgZy5yZXR1cm4oKTt9XG4gICAgY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFR5cGVFcnJvcikge1xuICAgICAgICBpZiAoJ0dlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmcnID09PSBlcnIubWVzc2FnZSkge1xuICAgICAgICAgIGNvbnRpbnVlfSB9XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7fSB9IH1cblxuY29uc3QgX2FvX3BpcGVfb3V0X2tpbmRzID17XG4gIGFvX3JhdzogZyA9PiBnXG4sIGFvX3NwbGl0OiBhb19zcGxpdFxuLCBhb190YXA6IGFvX3RhcH07XG5cbmZ1bmN0aW9uIF9hb19waXBlX291dChhZ19vdXQsIHNlbGYsIGtpbmQpIHtcbiAga2luZCA9IC9eYW9fLy50ZXN0KGtpbmQpID8ga2luZCA6ICdhb18nK2tpbmQ7XG4gIGxldCBhb193cmFwID0gX2FvX3BpcGVfb3V0X2tpbmRzW2tpbmRdO1xuICBpZiAodW5kZWZpbmVkID09PSBhb193cmFwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub253biBhb19waXBlX291dCBraW5kIFwiJHtraW5kfVwiYCl9XG5cbiAgcmV0dXJuIF9vYmpfYXNzaWduKGFvX3dyYXAoYWdfb3V0KSwgc2VsZikgfVxuXG5jb25zdCBfYW9fcGlwZSA9e1xuICBfX3Byb3RvX186IF9hb19waXBlX2Jhc2VcblxuLCAvLyB4Zm9sZDogdiA9PiB2IC0tIG9uIHB1c2g6IGlkZW50aXR5IHRyYW5zZm9ybVxuICAvLyB4cHVsbCgpIHt9IC0tIG1lbW9yeTogbm9uZVxuICAvLyB4ZW1pdDogX3hpbnZva2UgLS0gaWRlbnRpdHkgdHJhbnNmb3JtIG9yIGludm9rZSBpZiBmdW5jdGlvblxuXG4gIC8vICp4Z2ZvbGQoKSAtLSBvbiBwdXNoOiBnZW5lcmF0b3ItYmFzZWQgZm9sZCBpbXBsXG4gIC8vICp4c3JjKCkgLS0gZmVlZCB3aXRoIHNvdXJjZSBnZW5lcmF0b3JcbiAgLy8gKnhjdHgoZ2VuX3NyYykgLS0gb24gaW5pdDogYmluZCBldmVudCBzb3VyY2VzXG5cbiAga2luZDogJ3NwbGl0J1xuLCAvL19hc19waXBlX2luOiBfYW9fcGlwZV9pblxuICBfYXNfcGlwZV9vdXQ6IF9hb19waXBlX291dFxuXG4sIHhpbml0KGdfaW4sIGFnX291dCkge1xuICAgIGxldCB4Z2ZvbGQgPSB0aGlzLnhnZm9sZDtcbiAgICBpZiAodW5kZWZpbmVkICE9PSB4Z2ZvbGQpIHtcbiAgICAgIHRoaXMuX2luaXRfeGdmb2xkKGdfaW4sIHhnZm9sZCk7fVxuXG4gICAgdGhpcy5faW5pdF9jaGFpbihnX2luKTt9XG5cblxuLCBfaW5pdF94Z2ZvbGQoZ19pbiwgeGdmb2xkKSB7XG4gICAgaWYgKHVuZGVmaW5lZCA9PT0geGdmb2xkKSB7XG4gICAgICByZXR1cm59XG5cbiAgICBpZiAoX2lzX2ZuKHhnZm9sZCkpIHtcbiAgICAgIHhnZm9sZCA9IHhnZm9sZC5jYWxsKHRoaXMsIHRoaXMpO1xuXG4gICAgICBpZiAoX2lzX2ZuKHhnZm9sZCkpIHtcbiAgICAgICAgdGhpcy54Zm9sZCA9IHhnZm9sZDtcbiAgICAgICAgcmV0dXJuIHRydWV9XG5cbiAgICAgIHhnZm9sZC5uZXh0KCk7fVxuXG4gICAgdGhpcy54Z2ZvbGQgPSB4Z2ZvbGQ7XG4gICAgdGhpcy54Zm9sZCA9IHRoaXMuX2ZvbGRfZ2VuO1xuICAgIHRoaXMub25fZmluKHhnZm9sZCk7XG4gICAgcmV0dXJuIHRydWV9XG5cbiwgX2ZvbGRfZ2VuKHYpIHtcbiAgICBsZXQge2RvbmUsIHZhbHVlfSA9IHRoaXMueGdmb2xkLm5leHQodik7XG4gICAgaWYgKGRvbmUpIHt0aGlzLmRvbmUgPSB0cnVlO31cbiAgICByZXR1cm4gdmFsdWV9XG5cblxuLCBfaW5pdF9jaGFpbihnX2luKSB7XG4gICAgbGV0IHt4c3JjLCB4Y3R4fSA9IHRoaXM7XG4gICAgaWYgKHVuZGVmaW5lZCAhPT0geHNyYykge1xuICAgICAgYW9fZHJpdmUoeHNyYywgZ19pbilcbiAgICAgICAgLnRoZW4gKCgpID0+Z19pbi5yZXR1cm4oKSk7IH1cblxuICAgIGlmICh1bmRlZmluZWQgIT09IHhjdHgpIHtcbiAgICAgIHRoaXMuX3dpdGhfY3R4KGdfaW4sIHhjdHgpO30gfVxuXG4sIF93aXRoX2N0eChnX2luLCB4Y3R4KSB7XG4gICAgaWYgKF9pc19mbih4Y3R4KSkge1xuICAgICAgeGN0eCA9IHhjdHgoZ19pbik7fVxuXG4gICAgaWYgKHhjdHggJiYgeGN0eC5uZXh0KSB7XG4gICAgICB4Y3R4Lm5leHQoZ19pbik7XG4gICAgICB0aGlzLm9uX2Zpbih4Y3R4KTt9XG4gICAgcmV0dXJuIHhjdHh9IH07XG5cbmNvbnN0IGFvX3BpcGUgPSBfYW9fcGlwZS5jcmVhdGU7XG5cbmZ1bmN0aW9uIGFvX2ludGVydmFsKG1zPTEwMDApIHtcbiAgbGV0IFtfZmVuY2UsIF9yZXNldF0gPSBhb19mZW5jZV9mbigpO1xuICBsZXQgdGlkID0gc2V0SW50ZXJ2YWwoX3Jlc2V0LCBtcywgMSk7XG4gIGlmICh0aWQudW5yZWYpIHt0aWQudW5yZWYoKTt9XG4gIF9mZW5jZS5zdG9wID0gKCgpID0+IHtcbiAgICB0aWQgPSBjbGVhckludGVydmFsKHRpZCk7XG4gICAgX2ZlbmNlLmRvbmUgPSB0cnVlO30pO1xuICByZXR1cm4gX2ZlbmNlfVxuXG5cbmZ1bmN0aW9uIGFvX3RpbWVvdXQobXM9MTAwMCkge1xuICBsZXQgdGlkLCBbX2ZlbmNlLCBfcmVzZXRdID0gYW9fZmVuY2VfZm4odGltZW91dCk7XG4gIHJldHVybiB0aW1lb3V0XG5cbiAgZnVuY3Rpb24gdGltZW91dCgpIHtcbiAgICB0aWQgPSBzZXRUaW1lb3V0KF9yZXNldCwgbXMsIDEpO1xuICAgIGlmICh0aWQudW5yZWYpIHt0aWQudW5yZWYoKTt9XG4gICAgcmV0dXJuIF9mZW5jZSgpfSB9XG5cblxuZnVuY3Rpb24gYW9fZGVib3VuY2UobXM9MzAwLCBnZW5faW4pIHtcbiAgbGV0IHRpZCwgW19mZW5jZSwgX3Jlc2V0XSA9IGFvX2ZlbmNlX2ZuKCk7XG5cbiAgX2ZlbmNlLmZpbiA9ICgoYXN5bmMgKCkgPT4ge1xuICAgIGxldCBwO1xuICAgIGZvciBhd2FpdCAobGV0IHYgb2YgX3hpbnZva2UoZ2VuX2luKSkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpZCk7XG4gICAgICBpZiAoX2ZlbmNlLmRvbmUpIHtyZXR1cm59XG4gICAgICBwID0gX2ZlbmNlKCk7XG4gICAgICB0aWQgPSBzZXRUaW1lb3V0KF9yZXNldCwgbXMsIHYpO31cblxuICAgIGF3YWl0IHA7XG4gICAgX2ZlbmNlLmRvbmUgPSB0cnVlO30pKCkpO1xuXG4gIHJldHVybiBfZmVuY2V9XG5cblxuYXN5bmMgZnVuY3Rpb24gKiBhb190aW1lcyhnZW5faW4pIHtcbiAgbGV0IHRzMCA9IERhdGUubm93KCk7XG4gIGZvciBhd2FpdCAobGV0IHYgb2YgZ2VuX2luKSB7XG4gICAgeWllbGQgRGF0ZS5ub3coKSAtIHRzMDt9IH1cblxuZnVuY3Rpb24gYW9fZG9tX2FuaW1hdGlvbigpIHtcbiAgbGV0IHRpZCwgW19mZW5jZSwgX3Jlc2V0XSA9IGFvX2ZlbmNlX2ZuKHJhZik7XG4gIHJhZi5zdG9wID0gKCgpID0+IHtcbiAgICB0aWQgPSBjYW5jZWxBbmltYXRpb25GcmFtZSh0aWQpO1xuICAgIHJhZi5kb25lID0gdHJ1ZTt9KTtcbiAgcmV0dXJuIHJhZlxuXG4gIGZ1bmN0aW9uIHJhZigpIHtcbiAgICB0aWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoX3Jlc2V0KTtcbiAgICByZXR1cm4gX2ZlbmNlKCl9IH1cblxuY29uc3QgX2V2dF9pbml0ID0gUHJvbWlzZS5yZXNvbHZlKHt0eXBlOidpbml0J30pO1xuZnVuY3Rpb24gYW9fZG9tX2xpc3RlbihwaXBlID0gYW9fcXVldWUoKSkge1xuICBsZXQgd2l0aF9kb20gPSAoZG9tLCBmbikgPT5cbiAgICBkb20uYWRkRXZlbnRMaXN0ZW5lclxuICAgICAgPyBfYW9fd2l0aF9kb20oX2JpbmQsIGZuLCBkb20pXG4gICAgICA6IF9hb193aXRoX2RvbV92ZWMoX2JpbmQsIGZuLCBkb20pO1xuXG4gIF9iaW5kLnNlbGYgPSB7cGlwZSwgd2l0aF9kb219O1xuICBwaXBlLndpdGhfZG9tID0gd2l0aF9kb207XG4gIHJldHVybiBwaXBlXG5cbiAgZnVuY3Rpb24gX2JpbmQoZG9tLCBmbl9ldnQsIGZuX2RvbSkge1xuICAgIHJldHVybiBldnQgPT4ge1xuICAgICAgbGV0IHYgPSBmbl9ldnRcbiAgICAgICAgPyBmbl9ldnQoZXZ0LCBkb20sIGZuX2RvbSlcbiAgICAgICAgOiBmbl9kb20oZG9tLCBldnQpO1xuXG4gICAgICBpZiAobnVsbCAhPSB2KSB7XG4gICAgICAgIHBpcGUuZ19pbi5uZXh0KHYpO30gfSB9IH1cblxuXG5mdW5jdGlvbiBfYW9fd2l0aF9kb20oX2JpbmQsIGZuLCBkb20pIHtcbiAgbGV0IF9vbl9ldnQ7XG4gIGlmIChfaXNfZm4oZm4pKSB7XG4gICAgX2V2dF9pbml0LnRoZW4oXG4gICAgICBfb25fZXZ0ID0gX2JpbmQoZG9tLCB2b2lkIDAsIGZuKSk7IH1cblxuICByZXR1cm4ge1xuICAgIF9fcHJvdG9fXzogX2JpbmQuc2VsZlxuICAsIGxpc3RlbiguLi5hcmdzKSB7XG4gICAgICBsZXQgb3B0LCBldnRfZm4gPSBfb25fZXZ0O1xuXG4gICAgICBsZXQgbGFzdCA9IGFyZ3MucG9wKCk7XG4gICAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIGxhc3QpIHtcbiAgICAgICAgZXZ0X2ZuID0gX2JpbmQoZG9tLCBsYXN0LCBfb25fZXZ0KTtcbiAgICAgICAgbGFzdCA9IGFyZ3MucG9wKCk7fVxuXG4gICAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBsYXN0KSB7XG4gICAgICAgIGFyZ3MucHVzaChsYXN0KTt9XG4gICAgICBlbHNlIG9wdCA9IGxhc3Q7XG5cbiAgICAgIGZvciAobGV0IGV2dCBvZiBhcmdzKSB7XG4gICAgICAgIGRvbS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAgIGV2dCwgZXZ0X2ZuLCBvcHQpOyB9XG5cbiAgICAgIHJldHVybiB0aGlzfSB9IH1cblxuXG5mdW5jdGlvbiBfYW9fd2l0aF9kb21fdmVjKF9iaW5kLCBmbiwgZWN0eF9saXN0KSB7XG4gIGVjdHhfbGlzdCA9IEFycmF5LmZyb20oZWN0eF9saXN0LFxuICAgIGRvbSA9PiBfYW9fd2l0aF9kb20oX2JpbmQsIGZuLCBkb20pKTtcblxuICByZXR1cm4ge1xuICAgIF9fcHJvdG9fXzogX2JpbmQuc2VsZlxuICAsIGxpc3RlbiguLi5hcmdzKSB7XG4gICAgICBmb3IgKGxldCBlY3R4IG9mIGVjdHhfbGlzdCkge1xuICAgICAgICBlY3R4Lmxpc3RlbiguLi5hcmdzKTt9XG4gICAgICByZXR1cm4gdGhpc30gfSB9XG5cbmV4cG9ydCB7IF9hb19mZW5jZV9sb29wLCBfYW9fcGlwZSwgX2FvX3BpcGVfYmFzZSwgX2FvX3BpcGVfb3V0LCBfYW9fcGlwZV9vdXRfa2luZHMsIF9hb190YXAsIF94aW52b2tlLCBfeHBpcGVfdGd0LCBhb19kZWJvdW5jZSwgYW9fZGVmZXJyZWQsIGFvX2RlZmVycmVkX3YsIGFvX2RvbV9hbmltYXRpb24sIGFvX2RvbV9saXN0ZW4sIGFvX2RyaXZlLCBhb19mZW5jZV9mbiwgYW9fZmVuY2VfZm9yaywgYW9fZmVuY2Vfb2JqLCBhb19mZW5jZV92LCBhb19pbnRlcnZhbCwgYW9faXRlciwgYW9fcGlwZSwgYW9fcXVldWUsIGFvX3J1biwgYW9fc3BsaXQsIGFvX3N0ZXBfaXRlciwgYW9fc3ltX2RvbmUsIGFvX3RhcCwgYW9fdGltZW91dCwgYW9fdGltZXMsIGZuX2NoYWluLCBpc19hb19pdGVyLCBpdGVyLCBzdGVwX2l0ZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJvYXAubWpzLm1hcFxuIiwiaW1wb3J0IHthb190aW1lb3V0LCBhb190aW1lc30gZnJvbSAncm9hcCdcblxubGV0IGRlbW9fZHVyYXRpb24gPSBzZXRUaW1lb3V0IEAgQm9vbGVhbiwgMTUwMDBcblxuOjohPlxuICBsZXQgaSA9IDBcbiAgZm9yIGF3YWl0IGxldCB2IG9mIGFvX3RpbWVvdXQoMTAwMCkgOjpcbiAgICBjb25zb2xlLmxvZyBAICdhb190aW1lb3V0JywgQHt9IHYsIGk6IGkrK1xuXG46OiE+XG4gIGxldCBpID0gMFxuICBmb3IgYXdhaXQgbGV0IHRzIG9mIGFvX3RpbWVzIEAgYW9fdGltZW91dCgxMDAwKSA6OlxuICAgIGNvbnNvbGUubG9nIEAgJ2FvX3RpbWUgQCBhb190aW1lb3V0JywgQHt9IHRzLCBpOiBpKytcblxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU07QUFDTixFQUFFLE1BQU0sRUFBRSxXQUFXO0FBQ3JCLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVTtBQUM5QixDQUFDLEdBQUcsTUFBTSxDQUFDO0FBMkNYO0FBQ0EsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3RDO0FBQ0EsU0FBUyxVQUFVLEdBQUc7QUFDdEIsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxHQUFHLElBQUksRUFBRSxDQUFDO0FBQzVCLEVBQUUsSUFBSSxLQUFLLEdBQUcsQ0FBQyxJQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7QUFDL0I7QUFDQSxFQUFFLE9BQU87QUFDVCxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO0FBQ3JCLFFBQVEsQ0FBQyxHQUFHLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQztBQUM5QjtBQUNBLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtBQUNqQztBQUNBO0FBQ0E7QUFDQSxNQUFNLGFBQWEsRUFBRTtBQUNyQixFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQ2xDO0FBQ0EsRUFBRSxPQUFPLEdBQUc7QUFDWixJQUFJLE9BQU8sYUFBYSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNyQztBQUNBLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUc7QUFDM0IsSUFBSSxPQUFPLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUM7QUFDN0I7QUFDQSxTQUFTLFdBQVcsQ0FBQyxHQUFHLEVBQUU7QUFDMUIsRUFBRSxJQUFJLENBQUMsR0FBRyxVQUFVLEVBQUUsQ0FBQztBQUN2QixFQUFFLElBQUksU0FBUyxLQUFLLEdBQUcsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN0QyxFQUFFLEdBQUcsQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUM5QyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBTVg7QUFDQTtBQUNBLGlCQUFpQixhQUFhLENBQUMsS0FBSyxFQUFFO0FBQ3RDLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUU7QUFDdkIsSUFBSSxJQUFJLENBQUMsR0FBRyxNQUFNLEtBQUssRUFBRSxDQUFDO0FBQzFCLElBQUksSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxXQUFXLEVBQUU7QUFDekMsTUFBTSxPQUFPLENBQUMsQ0FBQztBQUNmLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO0FBc1VmO0FBQ0E7QUFDQSxTQUFTLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFO0FBQzdCLEVBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ25ELEVBQUUsT0FBTyxPQUFPO0FBQ2hCO0FBQ0EsRUFBRSxTQUFTLE9BQU8sR0FBRztBQUNyQixJQUFJLEdBQUcsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNwQyxJQUFJLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQ2pDLElBQUksT0FBTyxNQUFNLEVBQUUsQ0FBQyxFQUFFO0FBa0J0QjtBQUNBO0FBQ0EsaUJBQWlCLFFBQVEsQ0FBQyxNQUFNLEVBQUU7QUFDbEMsRUFBRSxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDdkIsRUFBRSxXQUFXLElBQUksQ0FBQyxJQUFJLE1BQU0sRUFBRTtBQUM5QixJQUFJLE1BQU0sSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDOztBQzNiNUIsK0JBQWdDOzs7RUFHOUI7YUFDUztJQUNQLFlBQWMsWUFBWSxFQUFLOzs7RUFHakM7YUFDUyxtQkFBcUI7SUFDNUIsWUFBYyxzQkFBc0IsRUFBSyJ9
